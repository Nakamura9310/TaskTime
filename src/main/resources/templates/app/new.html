<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>TaskTime</title>

	<!-- CSS -->
	<link rel="stylesheet" th:href="@{/css/style.css}" type="text/css">

	<!-- Bootstrap -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

</head>

<body>
	<!-- ナビゲーションバー -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
			<a class="navbar-brand text-dark" th:href="@{/app/top}">TaskTime</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
				aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
				<div class="navbar-nav">
					<a class="nav-link active" aria-current="page" th:href="@{/app/top}">Top</a>
					<a class="nav-link" th:href="@{/app/today}">today</a>
					<a class="nav-link" th:href="@{/app/done}">done</a>
					<form class="nav-link" th:action="@{/logout}" method="post"><input type="submit" value="Logout"
							class="btn btn-outline-secondary btn-sm"></form>
				</div>
			</div>

		</div>
	</nav>

	<div class="container-lg">


		<h2 class="p-3 bg-white rounded shadow" style="text-align:center">新しいタスクを入力してください</h2>

		<form method="POST" th:action="@{/app/new}">
			<table class="table table-borderd table-striped table-hover">
				<thead>
					<tr>
						<th style="text-align: center;">Task</th>
						<th style="text-align: center;">見積時間(h)</th>
						<th style="text-align: center;">予定日</th>
						<th style="text-align: center;">開始時刻</th>
						<th style="text-align: center;">優先度</th>
					</tr>
				</thead>

				<tbody th:object="${task}">
					<tr>
						<td><input type="text" th:field="*{taskName}" placeholder="タスク名" class="form-control"
								th:classappend="${#fields.hasErrors('taskName')}?'is-invalid'" autofocus><br>
							<span class="text-danger" th:if="${#fields.hasErrors('taskName')}"
								th:errors="*{taskName}"></span>
						</td>

						<td><span id="display"></span>(h)<br>
							<input id="time" type="range" min="0.5" max="6" step="0.5" value="0.5"
								th:field="*{estimatedTime}">
						</td>

						<td><input type="date" th:field="*{scheduledDate}" class="form-control"
								th:classappend="${#fields.hasErrors('scheduledDate')}?'is-invalid'"><br>
							<span class="text-danger" th:if="${#fields.hasErrors('scheduledDate')}"
								th:errors="*{scheduledDate}"></span>
						</td>

						<td><input type="time" th:field="*{startTime}" class="form-control"
								th:classappend="${#fields.hasErrors('startTime')}?'is-invalid'"><br>
							<span class="text-danger" th:if="${#fields.hasErrors('startTime')}"
								th:errors="*{startTime}"></span>
						</td>

						<td><select th:field="*{priority}" class="form-control">
								<option value="">未定</option>
								<option value="A">A：重要</option>
								<option value="B">B：普通</option>
								<option value="C">C：後で</option>
							</select></td>
					</tr>

				</tbody>
			</table>

			<!-- userID追加のための記述　hidden -->
			<div hidden th:object="${task}">
				<input type="text" readonly name="userID" th:value="${email}">
			</div>

			<p style="text-align:center">
				<button class="btn btn-primary">登録</button>
			</p>
		</form>

	</div>




	<!-- 見積時間 input type="range"表記のためのJavaScript -->
	<script>
		const inputElem = document.getElementById('time'); // input要素
		const currentValueElem = document.getElementById('display'); // 埋め込む先のspan要素

		// 現在の値を埋め込む関数
		const setCurrentValue = (val) => {
			currentValueElem.innerText = val;
		}

		// inputイベント時に値をセットする関数
		const rangeOnChange = (e) => {
			setCurrentValue(e.target.value);
		}

		window.onload = () => {
			inputElem.addEventListener('input', rangeOnChange); // スライダー変化時にイベントを発火
			setCurrentValue(inputElem.value); // ページ読み込み時に値をセット

		}

	</script>

	<!-- Bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
		crossorigin="anonymous"></script>


</body>

</html>